@model IEnumerable<PropertyManagementSystem.DAL.Entities.Lease>
@{
    ViewData["Title"] = "Lease Management";
    Layout = "_AuthLayout";
    ViewData["PortalMode"] = "Landlord";
}

<div class="pm-page">
    <div class="pm-page-header">
        <div>
            <h1 class="pm-page-title">
                <i class="bi bi-file-earmark-text"></i>
                Lease Management
            </h1>
            <p class="pm-page-subtitle">View and manage all lease contracts</p>
        </div>
        <div class="pm-page-actions">
            <span class="pm-badge pm-badge-primary" style="font-size: var(--pm-text-sm); padding: 8px 16px;">
                Total: @Model.Count() Contracts
            </span>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="pm-tabs-container">
        <div class="pm-tabs">
            <a asp-action="Index" class="pm-tab active">
                <i class="bi bi-list"></i> All Contracts
            </a>
            <a asp-action="MyLeases" class="pm-tab">
                <i class="bi bi-person"></i> My Leases
            </a>
            <a asp-action="MyProperties" class="pm-tab">
                <i class="bi bi-building"></i> My Properties
            </a>
        </div>
    </div>

    @if (!Model.Any())
    {
        <div class="pm-card">
            <div class="pm-card-body">
                <div class="pm-empty">
                    <div class="pm-empty-icon">
                        <i class="bi bi-file-earmark-x"></i>
                    </div>
                    <h4>No Contracts Yet</h4>
                    <p>Contracts will be created when rental applications are approved</p>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="pm-card">
            <div class="pm-table-wrapper" style="border: none; border-radius: 0;">
                <table class="pm-table">
                    <thead>
                        <tr>
                            <th>Contract #</th>
                            <th>Property</th>
                            <th>Tenant</th>
                            <th>Duration</th>
                            <th>Monthly Rent</th>
                            <th class="pm-text-center">Status</th>
                            <th class="pm-text-center">Role</th>
                            <th class="pm-text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var lease in Model.OrderByDescending(l => l.CreatedAt))
                        {
                            var isLandlord = lease.Property?.LandlordId == ViewBag.UserId;
                            <tr>
                                <td>
                                    <div>
                                        <strong class="pm-text-primary">@lease.LeaseNumber</strong>
                                    </div>
                                    <small class="pm-text-muted">@lease.CreatedAt.ToString("dd/MM/yyyy")</small>
                                </td>
                                <td>
                                    <div class="pm-flex pm-items-center pm-gap-3">
                                        <div class="pm-property-thumb">
                                            <i class="bi bi-building"></i>
                                        </div>
                                        <div>
                                            <strong>@lease.Property?.Name</strong>
                                            <br />
                                            <small class="pm-text-muted">@lease.Property?.Address</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div class="pm-flex pm-items-center pm-gap-3">
                                        <div class="pm-avatar pm-avatar-sm">@lease.Tenant?.FullName?.Substring(0, 1).ToUpper()</div>
                                        <div>
                                            <strong>@lease.Tenant?.FullName</strong>
                                            <br />
                                            <small class="pm-text-muted">@lease.Tenant?.Email</small>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <div>@lease.StartDate.ToString("dd/MM/yyyy")</div>
                                    <small class="pm-text-muted">to @lease.EndDate.ToString("dd/MM/yyyy")</small>
                                </td>
                                <td>
                                    <strong class="pm-text-success">$@lease.MonthlyRent.ToString("N0")</strong>
                                    <br />
                                    <small class="pm-text-muted">Due: Day @lease.PaymentDueDay</small>
                                </td>
                                <td class="pm-text-center">
                                    @switch (lease.Status)
                                    {
                                        case "Draft":
                                            <span class="pm-badge pm-badge-secondary">Draft</span>
                                            break;
                                        case "PendingSignature":
                                            <span class="pm-badge pm-badge-warning">Pending Signature</span>
                                            break;
                                        case "Active":
                                            <span class="pm-badge pm-badge-success">Active</span>
                                            break;
                                        case "Expired":
                                            <span class="pm-badge pm-badge-danger">Expired</span>
                                            break;
                                        case "Terminated":
                                            <span class="pm-badge pm-badge-secondary" style="background: var(--pm-slate-700); color: white;">Terminated</span>
                                            break;
                                        case "Renewed":
                                            <span class="pm-badge pm-badge-info">Renewed</span>
                                            break;
                                        default:
                                            <span class="pm-badge pm-badge-secondary">@lease.Status</span>
                                            break;
                                    }
                                </td>
                                <td class="pm-text-center">
                                    @if (isLandlord)
                                    {
                                        <span class="pm-badge pm-badge-info">Landlord</span>
                                    }
                                    else
                                    {
                                        <span class="pm-badge pm-badge-primary">Tenant</span>
                                    }
                                </td>
                                <td class="pm-text-center">
                                    <a asp-action="Details" asp-route-id="@lease.LeaseId" class="pm-btn pm-btn-primary pm-btn-sm">
                                        <i class="bi bi-eye"></i> View
                                    </a>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>

<style>
    .pm-page {
        max-width: 1400px;
        margin: 0 auto;
    }

    .pm-page-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: var(--pm-space-6);
    }

    .pm-page-title {
        font-size: var(--pm-text-2xl);
        font-weight: var(--pm-font-bold);
        color: var(--pm-text);
        margin: 0 0 var(--pm-space-2);
        display: flex;
        align-items: center;
        gap: var(--pm-space-3);
    }

    .pm-page-title i {
        color: var(--pm-primary);
    }

    .pm-page-subtitle {
        font-size: var(--pm-text-sm);
        color: var(--pm-text-secondary);
        margin: 0;
    }

    .pm-tabs-container {
        margin-bottom: var(--pm-space-6);
    }

    .pm-tabs {
        display: flex;
        gap: var(--pm-space-2);
        border-bottom: 1px solid var(--pm-border);
        padding-bottom: 0;
    }

    .pm-tab {
        display: flex;
        align-items: center;
        gap: var(--pm-space-2);
        padding: var(--pm-space-3) var(--pm-space-5);
        font-size: var(--pm-text-sm);
        font-weight: var(--pm-font-medium);
        color: var(--pm-text-secondary);
        text-decoration: none;
        border-bottom: 2px solid transparent;
        margin-bottom: -1px;
        transition: all var(--pm-transition-fast);
    }

    .pm-tab:hover {
        color: var(--pm-text);
    }

    .pm-tab.active {
        color: var(--pm-primary);
        border-bottom-color: var(--pm-primary);
    }

    .pm-property-thumb {
        width: 40px;
        height: 40px;
        background: var(--pm-primary-100);
        color: var(--pm-primary);
        border-radius: var(--pm-radius);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        flex-shrink: 0;
    }

    @@media (max-width: 768px) {
        .pm-page-header {
            flex-direction: column;
            gap: var(--pm-space-4);
        }

        .pm-tabs {
            overflow-x: auto;
            flex-wrap: nowrap;
            padding-bottom: var(--pm-space-1);
        }

        .pm-tab {
            white-space: nowrap;
        }
    }
</style>
