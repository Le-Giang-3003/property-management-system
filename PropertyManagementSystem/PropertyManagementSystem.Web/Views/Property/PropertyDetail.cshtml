@model PropertyManagementSystem.DAL.Entities.Property

@{
    ViewData["Title"] = $"{Model.Name} - Chi tiết";
    Layout = "_AuthLayout";
}

<div class="container mt-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-action="Index">Danh sách BDS</a></li>
            <li class="breadcrumb-item active">@Model.Name</li>
        </ol>
    </nav>

    <!-- Hero Section -->
    <div class="row mb-4">
        <!-- Main Info -->
        <div class="col-lg-8">
            <div class="card">
                <div class="card-body">
                    <h1>@Model.Name</h1>
                    <div class="mb-3">
                        <span class="badge badge-light">@Model.PropertyType</span>
                        <span class="badge @GetStatusBadgeClass(Model.Status)">@GetStatusDisplay(Model.Status)</span>
                        @if (Model.IsFurnished)
                        {
                            <span class="badge badge-info">Nội thất đầy đủ</span>
                        }
                        @if (Model.PetsAllowed)
                        {
                            <span class="badge badge-success">Cho phép thú cưng</span>
                        }
                    </div>
                    <p class="text-muted">
                        <strong>@Model.Bedrooms</strong> Phòng ngủ •
                        <strong>@Model.Bathrooms</strong> Phòng tắm •
                        <strong>@Model.SquareFeet.ToString("N0")</strong> ft²
                    </p>
                </div>
            </div>
        </div>

        <!-- Price & Actions -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-body">
                    <!-- Price -->
                    <div class="text-center mb-3">
                        <h2 class="text-success">@Model.RentAmount.ToString("N0") ₫</h2>
                        <p class="text-muted">/tháng</p>
                        @if (Model.DepositAmount.HasValue)
                        {
                            <span class="badge badge-warning">
                                Cọc: @Model.DepositAmount.Value.ToString("N0") ₫
                            </span>
                        }
                    </div>

                    <!-- Availability -->
                    @if (Model.AvailableFrom.HasValue)
                    {
                        <div class="mb-3 text-center">
                            <small class="text-muted d-block">Có sẵn từ</small>
                            <strong>@Model.AvailableFrom.Value.ToString("dd/MM/yyyy")</strong>
                        </div>
                    }

                    <!-- Actions -->
                    <div class="btn-group-vertical w-100">
                        <a asp-action="Edit" asp-route-id="@Model.PropertyId" class="btn btn-warning">
                            Chỉnh sửa thông tin
                        </a>
                        <a asp-action="ChangeStatus" asp-route-id="@Model.PropertyId" class="btn btn-primary">
                            Thay đổi trạng thái
                        </a>
                        <a asp-action="Delete" asp-route-id="@Model.PropertyId" class="btn btn-danger">
                            Xóa BDS
                        </a>
                        <a asp-action="Index" class="btn btn-secondary">
                            Danh sách BDS
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Details Section -->
    <div class="row">
        <!-- Left Column -->
        <div class="col-lg-8">
            <!-- Location -->
            <div class="card mb-3">
                <div class="card-header">
                    <h5 class="mb-0">Vị trí & Địa chỉ</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <small class="text-muted d-block">Địa chỉ đầy đủ</small>
                        <strong>@Model.Address</strong>
                    </div>
                    @if (!string.IsNullOrEmpty(Model.City) || !string.IsNullOrEmpty(Model.District))
                    {
                        <div class="mb-2">
                            <small class="text-muted d-block">Khu vực</small>
                            <strong>
                                @if (!string.IsNullOrEmpty(Model.District))
                                {
                                    @Model.District
                                    <span>, </span>
                                }
                                @Model.City
                            </strong>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(Model.ZipCode))
                    {
                        <div class="mb-2">
                            <small class="text-muted d-block">Mã bưu điện</small>
                            <strong>@Model.ZipCode</strong>
                        </div>
                    }
                    @if (Model.Latitude.HasValue && Model.Longitude.HasValue)
                    {
                        <div class="mt-3 pt-3 border-top">
                            <small class="text-muted d-block mb-1">Tọa độ GPS</small>
                            <code>@Model.Latitude.Value.ToString("F6"), @Model.Longitude.Value.ToString("F6")</code>
                            <br>
                            <a href="https://maps.google.com/?q=@Model.Latitude,@Model.Longitude"
                               target="_blank" class="btn btn-sm btn-outline-primary mt-2">
                                Xem trên Google Maps
                            </a>
                        </div>
                    }
                </div>
            </div>

            <!-- Description -->
            @if (!string.IsNullOrEmpty(Model.Description))
            {
                <div class="card mb-3">
                    <div class="card-header">
                        <h5 class="mb-0">Mô tả chi tiết</h5>
                    </div>
                    <div class="card-body">
                        <p class="text-muted">
                            @Html.Raw(Model.Description.Replace("\n", "<br/>"))
                        </p>
                    </div>
                </div>
            }

            <!-- Amenities & Utilities -->
            @if (!string.IsNullOrEmpty(Model.Amenities) || !string.IsNullOrEmpty(Model.UtilitiesIncluded))
            {
                <div class="card mb-3">
                    <div class="card-header">
                        <h5 class="mb-0">Tiện ích & Dịch vụ</h5>
                    </div>
                    <div class="card-body">
                        @if (!string.IsNullOrEmpty(Model.Amenities))
                        {
                            <div class="mb-3">
                                <h6>Tiện ích nổi bật</h6>
                                @foreach (var amenity in Model.Amenities.Split(',', StringSplitOptions.RemoveEmptyEntries))
                                {
                                    <span class="badge badge-light border">@amenity.Trim()</span>
                                }
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(Model.UtilitiesIncluded))
                        {
                            <div class="@(!string.IsNullOrEmpty(Model.Amenities) ? "pt-3 border-top" : "")">
                                <h6>Tiện ích đi kèm</h6>
                                @foreach (var utility in Model.UtilitiesIncluded.Split(',', StringSplitOptions.RemoveEmptyEntries))
                                {
                                    <span class="badge badge-info">@utility.Trim()</span>
                                }
                            </div>
                        }
                    </div>
                </div>
            }
        </div>

        <!-- Right Column -->
        <div class="col-lg-4">
            <!-- Landlord -->
            @if (Model.Landlord != null)
            {
                <div class="card mb-3">
                    <div class="card-header">
                        <h6 class="mb-0">Chủ sở hữu</h6>
                    </div>
                    <div class="card-body">
                        <h5>@Model.Landlord.FullName</h5>
                        <p class="mb-1">
                            <small class="text-muted">Email:</small><br>
                            <a href="mailto:@Model.Landlord.Email">@Model.Landlord.Email</a>
                        </p>
                        @if (!string.IsNullOrEmpty(Model.Landlord.PhoneNumber))
                        {
                            <p class="mb-0">
                                <small class="text-muted">Điện thoại:</small><br>
                                <a href="tel:@Model.Landlord.PhoneNumber">@Model.Landlord.PhoneNumber</a>
                            </p>
                        }
                    </div>
                </div>
            }

            <!-- System Info -->
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">Thông tin hệ thống</h6>
                </div>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item">
                        <small class="text-muted">ID BDS:</small><br>
                        <strong>#@Model.PropertyId</strong>
                    </li>
                    <li class="list-group-item">
                        <small class="text-muted">Ngày tạo:</small><br>
                        <strong>@Model.CreatedAt.ToString("dd/MM/yyyy HH:mm")</strong>
                    </li>
                    @if (Model.UpdatedAt.HasValue)
                    {
                        <li class="list-group-item">
                            <small class="text-muted">Cập nhật lần cuối:</small><br>
                            <strong>@Model.UpdatedAt.Value.ToString("dd/MM/yyyy HH:mm")</strong>
                        </li>
                    }
                    <li class="list-group-item">
                        <small class="text-muted">Trạng thái:</small><br>
                        <span class="badge @GetStatusBadgeClass(Model.Status)">
                            @GetStatusDisplay(Model.Status)
                        </span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Open Google Maps in new tab
        document.querySelectorAll('a[href*="maps.google"]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                window.open(this.getAttribute('href'), '_blank');
            });
        });
    </script>
}

@functions {
    string GetStatusBadgeClass(string status)
    {
        return status switch
        {
            "Available" => "badge-success",
            "Rented" => "badge-warning",
            "Maintenance" => "badge-info",
            "Unavailable" => "badge-secondary",
            _ => "badge-secondary"
        };
    }

    string GetStatusDisplay(string status)
    {
        return status switch
        {
            "Available" => "Có sẵn",
            "Rented" => "Đã thuê",
            "Maintenance" => "Bảo trì",
            "Unavailable" => "Không khả dụng",
            _ => status
        };
    }

    string GetStatusIcon(string status)
    {
        return status switch
        {
            "Available" => "fa-check-circle",
            "Rented" => "fa-handshake",
            "Maintenance" => "fa-tools",
            "Unavailable" => "fa-ban",
            _ => "fa-question-circle"
        };
    }
}
