@model PropertyManagementSystem.DAL.Entities.Property

@{
    ViewData["Title"] = "Chỉnh sửa BDS";
    var propertyTypes = ViewBag.PropertyTypes as List<SelectListItem> ?? new();
    var statuses = new List<SelectListItem>
    {
        new() { Value = "Available", Text = "Có sẵn" },
        new() { Value = "Rented", Text = "Đã thuê" },
        new() { Value = "Maintenance", Text = "Bảo trì" },
        new() { Value = "Unavailable", Text = "Không khả dụng" }
    };
}

<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-xl-10">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-5">
                <div>
                    <h1 class="display-5 fw-bold mb-1">
                        <i class="fas fa-edit me-3 text-warning"></i>
                        Chỉnh sửa @Model.Name
                    </h1>
                    <p class="lead text-muted mb-0">
                        <span class="badge bg-info">@Model.Status</span>
                        <span class="ms-2">@Model.PropertyType • @Model.SquareFeet:N0 ft²</span>
                    </p>
                </div>
                <div class="d-flex gap-2">
                    <a asp-action="Details" asp-route-id="@Model.PropertyId"
                       class="btn btn-outline-primary btn-lg px-4">
                        <i class="fas fa-eye me-2"></i>Xem chi tiết
                    </a>
                    <a asp-action="Index" class="btn btn-outline-secondary btn-lg px-4">
                        <i class="fas fa-list me-2"></i>Danh sách
                    </a>
                </div>
            </div>

            <!-- Edit Form -->
            <div class="card shadow-lg border-0">
                <div class="card-header bg-gradient-warning text-white py-4 px-5">
                    <h3 class="mb-0 fw-bold">
                        <i class="fas fa-cogs me-3"></i>Cập nhật thông tin
                    </h3>
                </div>
                <div class="card-body p-5">
                    <form asp-action="Edit" method="post">
                        <input type="hidden" asp-for="PropertyId" />
                        <input type="hidden" asp-for="LandlordId" />
                        <input type="hidden" asp-for="CreatedAt" />

                        @if (!ViewData.ModelState.IsValid)
                        {
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Vui lòng sửa các lỗi sau:
                                <div asp-validation-summary="All"></div>
                            </div>
                        }

                        <div class="row g-4 mb-5">
                            <!-- Name & Type -->
                            <div class="col-lg-8">
                                <label asp-for="Name" class="form-label fw-bold fs-5"></label>
                                <input asp-for="Name" class="form-control form-control-lg shadow-sm" />
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>
                            <div class="col-lg-4">
                                <label asp-for="PropertyType" class="form-label fw-bold fs-5"></label>
                                <select asp-for="PropertyType" class="form-select form-select-lg shadow-sm">
                                    @foreach (var type in propertyTypes)
                                    {
                                        <option value="@type.Value" selected="@(type.Value == Model.PropertyType ? "selected" : null)">@type.Text</option>
                                    }
                                </select>
                                <span asp-validation-for="PropertyType" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Location -->
                        <div class="row g-4 mb-5">
                            <div class="col-xl-7">
                                <label asp-for="Address" class="form-label fw-bold fs-5"></label>
                                <input asp-for="Address" class="form-control form-control-lg shadow-sm" />
                                <span asp-validation-for="Address" class="text-danger"></span>
                            </div>
                            <div class="col-xl-5">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label asp-for="City" class="form-label fw-bold"></label>
                                        <input asp-for="City" class="form-control shadow-sm" />
                                        <span asp-validation-for="City" class="text-danger"></span>
                                    </div>
                                    <div class="col-md-6">
                                        <label asp-for="District" class="form-label fw-bold"></label>
                                        <input asp-for="District" class="form-control shadow-sm" />
                                        <span asp-validation-for="District" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Specs & Pricing -->
                        <div class="row g-4 mb-5">
                            <div class="col-md-3">
                                <label asp-for="Bedrooms" class="form-label fw-bold text-center d-block">Phòng ngủ</label>
                                <input asp-for="Bedrooms" type="number" min="0" max="20"
                                       class="form-control shadow-sm text-center fs-4" />
                                <span asp-validation-for="Bedrooms" class="text-danger d-block text-center"></span>
                            </div>
                            <div class="col-md-3">
                                <label asp-for="Bathrooms" class="form-label fw-bold text-center d-block">Phòng tắm</label>
                                <input asp-for="Bathrooms" type="number" min="0" max="10"
                                       class="form-control shadow-sm text-center fs-4" />
                                <span asp-validation-for="Bathrooms" class="text-danger d-block text-center"></span>
                            </div>
                            <div class="col-md-3">
                                <label asp-for="SquareFeet" class="form-label fw-bold text-center d-block">Diện tích</label>
                                <input asp-for="SquareFeet" type="number" step="0.01"
                                       class="form-control shadow-sm text-center fs-4" />
                                <span asp-validation-for="SquareFeet" class="text-danger d-block text-center"></span>
                            </div>
                            <div class="col-md-3">
                                <label asp-for="Status" class="form-label fw-bold text-center d-block">Trạng thái</label>
                                <select asp-for="Status" class="form-select shadow-sm fs-5">
                                    @foreach (var status in statuses)
                                    {
                                        <option value="@status.Value" selected="@(status.Value == Model.Status ? "selected" : null)">@status.Text</option>
                                    }
                                </select>
                                <span asp-validation-for="Status" class="text-danger d-block text-center"></span>
                            </div>
                        </div>

                        <!-- Pricing -->
                        <div class="row g-4 mb-5 p-4 bg-light rounded-3">
                            <div class="col-md-6">
                                <label asp-for="RentAmount" class="form-label fw-bold fs-5"></label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text bg-white fs-5">₫</span>
                                    <input asp-for="RentAmount" type="number" step="100000" min="0"
                                           class="form-control shadow-sm text-end fs-5" />
                                    <span class="input-group-text bg-white fs-5">/tháng</span>
                                </div>
                                <span asp-validation-for="RentAmount" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="DepositAmount" class="form-label fw-bold fs-5"></label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text bg-white fs-5">₫</span>
                                    <input asp-for="DepositAmount" type="number" step="100000" min="0"
                                           class="form-control shadow-sm text-end fs-5" />
                                    <span class="input-group-text bg-white fs-5">cọc</span>
                                </div>
                                <span asp-validation-for="DepositAmount" class="text-danger"></span>
                            </div>
                        </div>

                        <!-- Advanced Features -->
                        <div class="row g-4 mb-5">
                            <div class="col-lg-8">
                                <label asp-for="Description" class="form-label fw-bold fs-5 mb-3"></label>
                                <textarea asp-for="Description" rows="5"
                                          class="form-control shadow-sm"
                                          placeholder="Mô tả chi tiết..."></textarea>
                                <span asp-validation-for="Description" class="text-danger"></span>
                            </div>
                            <div class="col-lg-4">
                                <!-- Tiện ích -->
                                <div class="mb-4">
                                    <h6 class="fw-bold mb-3">Tiện ích</h6>
                                    <div class="form-check form-switch mb-2">
                                        <input asp-for="IsFurnished" class="form-check-input" type="checkbox" />
                                        <label class="form-check-label fw-semibold" asp-for="IsFurnished">
                                            Nội thất full
                                        </label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input asp-for="PetsAllowed" class="form-check-input" type="checkbox" />
                                        <label class="form-check-label fw-semibold" asp-for="PetsAllowed">
                                            Cho phép thú cưng
                                        </label>
                                    </div>
                                </div>

                                <!-- Ngày có sẵn -->
                                <div>
                                    <label asp-for="AvailableFrom" class="form-label fw-bold"></label>
                                    <input asp-for="AvailableFrom" type="date" class="form-control shadow-sm" />
                                    <span asp-validation-for="AvailableFrom" class="text-danger"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-grid gap-3 d-md-flex justify-content-between">
                            <button type="submit" class="btn btn-warning btn-lg px-5 py-3 shadow-lg me-md-3">
                                <i class="fas fa-save me-2"></i>
                                <span class="fs-5 fw-bold">Cập nhật BDS</span>
                            </button>
                            <div class="d-flex gap-2">
                                <a asp-action="Details" asp-route-id="@Model.PropertyId"
                                   class="btn btn-outline-primary btn-lg px-4">
                                    <i class="fas fa-eye me-2"></i>Xem trước
                                </a>
                                <a asp-action="Index" class="btn btn-outline-secondary btn-lg px-4">
                                    <i class="fas fa-list me-2"></i>Danh sách
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .bg-gradient-warning {
            background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
        }

        .form-switch .form-check-input:checked {
            background-color: #ffc107;
            border-color: #ffc107;
        }
    </style>
}

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // Currency formatting
        ['RentAmount', 'DepositAmount'].forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                input.addEventListener('input', function() {
                    this.value = this.value.replace(/[^0-9.]/g, '');
                });
            }
        });
    </script>
}
