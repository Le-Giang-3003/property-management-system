@using System.Security.Claims
@model PropertyManagementSystem.BLL.DTOs.Maintenance.MaintenanceRequestDto
@{
    ViewData["Title"] = "Request Details";
    Layout = "_AuthLayout";
    var currentUserId = int.Parse(User.FindFirstValue(System.Security.Claims.ClaimTypes.NameIdentifier));
    var isTenant = Model.RequestedBy == currentUserId;
    var isLandlord = User.IsInRole("Landlord") || User.IsInRole("Member");
    var isTechnician = User.IsInRole("Technician");
    var technicians = ViewBag.Technicians as List<PropertyManagementSystem.BLL.DTOs.Auth.UserDto>;
}

<style>
    .details-container {
        padding: 30px;
        background-color: #f8fafc;
        min-height: calc(100vh - 80px);
    }

    .details-header {
        background: white;
        border-radius: 16px;
        padding: 30px;
        margin-bottom: 24px;
        border: 1px solid #e2e8f0;
    }

    .header-top {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
    }

    .request-title {
        flex: 1;
    }

    .request-title h1 {
        font-size: 24px;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 8px;
    }

    .request-number {
        font-size: 14px;
        color: #64748b;
        font-weight: 500;
    }

    .status-badge {
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .status-pending {
        background-color: #fef3c7;
        color: #d97706;
    }

    .status-assigned {
        background-color: #dbeafe;
        color: #2563eb;
    }

    .status-inprogress {
        background-color: #e0e7ff;
        color: #6366f1;
    }

    .status-completed {
        background-color: #d1fae5;
        color: #059669;
    }

    .status-closed {
        background-color: #e2e8f0;
        color: #475569;
    }

    .status-cancelled {
        background-color: #fee2e2;
        color: #dc2626;
    }

    .priority-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        margin-left: 8px;
    }

    .priority-low {
        background-color: #d1fae5;
        color: #059669;
    }

    .priority-medium {
        background-color: #fef3c7;
        color: #d97706;
    }

    .priority-high {
        background-color: #fed7aa;
        color: #c2410c;
    }

    .priority-emergency {
        background-color: #fee2e2;
        color: #dc2626;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .info-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    .info-label {
        font-size: 12px;
        font-weight: 600;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .info-value {
        font-size: 15px;
        color: #1e293b;
        font-weight: 500;
    }

    .details-content {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 24px;
    }

    .main-content, .sidebar-content {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }

    .card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        border: 1px solid #e2e8f0;
    }

    .card-title {
        font-size: 18px;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .card-title i {
        color: #2563eb;
    }

    .description-text {
        color: #475569;
        line-height: 1.6;
        white-space: pre-wrap;
    }

    .images-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 12px;
    }

    .image-item {
        aspect-ratio: 1;
        border-radius: 12px;
        overflow: hidden;
        border: 2px solid #e2e8f0;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .image-item:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .image-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .no-images {
        text-align: center;
        padding: 40px;
        color: #94a3b8;
    }

    .contact-info {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        background-color: #f8fafc;
        border-radius: 12px;
        margin-bottom: 12px;
    }

    .contact-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 18px;
    }

    .contact-details {
        flex: 1;
    }

    .contact-name {
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 2px;
    }

    .contact-text {
        font-size: 13px;
        color: #64748b;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .action-buttons {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .btn {
        padding: 12px 20px;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        text-decoration: none;
    }

    .btn-primary {
        background-color: #2563eb;
        color: white;
    }

    .btn-primary:hover {
        background-color: #1d4ed8;
        transform: translateY(-1px);
        color: white;
    }

    .btn-success {
        background-color: #059669;
        color: white;
    }

    .btn-success:hover {
        background-color: #047857;
        transform: translateY(-1px);
        color: white;
    }

    .btn-danger {
        background-color: #dc2626;
        color: white;
    }

    .btn-danger:hover {
        background-color: #b91c1c;
        transform: translateY(-1px);
        color: white;
    }

    .btn-warning {
        background-color: #d97706;
        color: white;
    }

    .btn-warning:hover {
        background-color: #b45309;
        transform: translateY(-1px);
        color: white;
    }

    .btn-secondary {
        background-color: #e2e8f0;
        color: #475569;
    }

    .btn-secondary:hover {
        background-color: #cbd5e1;
        color: #475569;
    }

    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .modal-overlay.active {
        display: flex;
    }

    .modal-content {
        background: white;
        border-radius: 20px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e2e8f0;
    }

    .modal-title {
        font-size: 20px;
        font-weight: 700;
        color: #1e293b;
    }

    .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        color: #94a3b8;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
    }

    .modal-close:hover {
        background-color: #f1f5f9;
        color: #475569;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        font-size: 14px;
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
        display: block;
    }

    .form-control {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        font-size: 14px;
        transition: all 0.2s ease;
    }

    .form-control:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    textarea.form-control {
        resize: vertical;
        min-height: 100px;
        font-family: inherit;
    }

    .rating-stars {
        display: flex;
        gap: 8px;
        font-size: 32px;
        margin-bottom: 20px;
    }

    .rating-stars i {
        cursor: pointer;
        color: #cbd5e1;
        transition: all 0.2s ease;
    }

    .rating-stars i:hover,
    .rating-stars i.active {
        color: #fbbf24;
    }

    .modal-actions {
        display: flex;
        gap: 12px;
        margin-top: 24px;
    }

    @@media (max-width: 968px) {
        .details-content {
            grid-template-columns: 1fr;
        }
    }
</style>

<div class="details-container">
    <div class="details-header">
        <div class="header-top">
            <div class="request-title">
                <h1>@Model.Title</h1>
                <span class="request-number">#@Model.RequestNumber</span>
                <span class="priority-badge priority-@Model.Priority.ToLower()">@Model.Priority</span>
            </div>
            <span class="status-badge status-@Model.Status.ToLower().Replace(" ", "")">@Model.Status</span>
        </div>

        <div class="info-grid">
            <div class="info-item">
                <span class="info-label">Category</span>
                <span class="info-value">@Model.Category</span>
            </div>
            <div class="info-item">
                <span class="info-label">Location</span>
                <span class="info-value">@(Model.Location ?? "Not specified")</span>
            </div>
            <div class="info-item">
                <span class="info-label">Request Date</span>
                <span class="info-value">@Model.RequestDate.ToString("MMM dd, yyyy")</span>
            </div>
            @if (Model.RepairDate.HasValue)
            {
                <div class="info-item">
                    <span class="info-label">Preferred Date</span>
                    <span class="info-value">
                        @Model.RepairDate.Value.ToString("MMM dd, yyyy")
                        @if (Model.TimeFrom.HasValue && Model.TimeTo.HasValue)
                        {
                            <text> (@Model.TimeFrom.Value.ToString("hh:mm tt") - @Model.TimeTo.Value.ToString("hh:mm tt"))</text>
                        }
                    </span>
                </div>
            }
            @if (Model.EstimatedCost.HasValue)
            {
                <div class="info-item">
                    <span class="info-label">Estimated Cost</span>
                    <span class="info-value">$@Model.EstimatedCost.Value.ToString("N2")</span>
                </div>
            }
            @if (Model.ActualCost.HasValue)
            {
                <div class="info-item">
                    <span class="info-label">Actual Cost</span>
                    <span class="info-value">$@Model.ActualCost.Value.ToString("N2")</span>
                </div>
            }
        </div>
    </div>

    <div class="details-content">
        <div class="main-content">
            <div class="card">
                <h3 class="card-title">
                    <i class="bi bi-file-text"></i>
                    Description
                </h3>
                <p class="description-text">@Model.Description</p>
            </div>

            @if (Model.Images != null && Model.Images.Any())
            {
                <div class="card">
                    <h3 class="card-title">
                        <i class="bi bi-images"></i>
                        Images (@Model.Images.Count)
                    </h3>
                    <div class="images-grid">
                        @foreach (var image in Model.Images)
                        {
                            <div class="image-item" onclick="openImageModal('@image.ImagePath')">
                                <img src="@image.ImagePath" alt="Maintenance image" />
                            </div>
                        }
                    </div>
                </div>
            }
            else
            {
                <div class="card">
                    <h3 class="card-title">
                        <i class="bi bi-images"></i>
                        Images
                    </h3>
                    <div class="no-images">
                        <i class="bi bi-image" style="font-size: 48px; color: #cbd5e1;"></i>
                        <p>No images uploaded</p>
                    </div>
                </div>
            }

            @if (!string.IsNullOrEmpty(Model.ResolutionNotes))
            {
                <div class="card">
                    <h3 class="card-title">
                        <i class="bi bi-check-circle"></i>
                        Resolution Notes
                    </h3>
                    <p class="description-text">@Model.ResolutionNotes</p>
                </div>
            }

            @if (Model.Rating.HasValue)
            {
                <div class="card">
                    <h3 class="card-title">
                        <i class="bi bi-star-fill"></i>
                        Tenant Rating
                    </h3>
                    <div class="rating-stars">
                        @for (int i = 1; i <= 5; i++)
                        {
                            <i class="bi bi-star-fill @(i <= Model.Rating.Value ? "active" : "")" style="cursor: default;"></i>
                        }
                    </div>
                    @if (!string.IsNullOrEmpty(Model.TenantFeedback))
                    {
                        <p class="description-text">@Model.TenantFeedback</p>
                    }
                </div>
            }
        </div>

        <div class="sidebar-content">
            <div class="card">
                <h3 class="card-title">
                    <i class="bi bi-building"></i>
                    Property
                </h3>
                <div class="info-item">
                    <span class="info-label">Name</span>
                    <span class="info-value">@Model.PropertyName</span>
                </div>
                <div class="info-item" style="margin-top: 12px;">
                    <span class="info-label">Address</span>
                    <span class="info-value">@Model.PropertyAddress</span>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">
                    <i class="bi bi-people"></i>
                    Contact Information
                </h3>
                <div class="contact-info">
                    <div class="contact-avatar">@Model.TenantName.Substring(0, 1).ToUpper()</div>
                    <div class="contact-details">
                        <div class="contact-name">@Model.TenantName</div>
                        <div class="contact-text">
                            <i class="bi bi-person"></i> Tenant
                        </div>
                        @if (!string.IsNullOrEmpty(Model.TenantPhone))
                        {
                            <div class="contact-text">
                                <i class="bi bi-telephone"></i> @Model.TenantPhone
                            </div>
                        }
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(Model.TechnicianName))
                {
                    <div class="contact-info">
                        <div class="contact-avatar">@Model.TechnicianName.Substring(0, 1).ToUpper()</div>
                        <div class="contact-details">
                            <div class="contact-name">@Model.TechnicianName</div>
                            <div class="contact-text">
                                <i class="bi bi-wrench"></i> Technician
                            </div>
                            @if (!string.IsNullOrEmpty(Model.TechnicianPhone))
                            {
                                <div class="contact-text">
                                    <i class="bi bi-telephone"></i> @Model.TechnicianPhone
                                </div>
                            }
                        </div>
                    </div>
                }
            </div>

            <div class="card">
                <h3 class="card-title">
                    <i class="bi bi-lightning"></i>
                    Actions
                </h3>
                <div class="action-buttons">
                    @* TENANT ACTIONS *@
                    @if (isTenant)
                    {
                        @if (Model.Status == "Pending" || Model.Status == "Assigned")
                        {
                            <button class="btn btn-danger" onclick="confirmCancel(@Model.RequestId)">
                                <i class="bi bi-x-circle"></i> Cancel Request
                            </button>
                        }
                        @if (Model.Status == "Completed" && !Model.Rating.HasValue)
                        {
                            <button class="btn btn-warning" onclick="openRateModal(@Model.RequestId)">
                                <i class="bi bi-star"></i> Rate Service
                            </button>
                        }
                    }

                    @* LANDLORD ACTIONS *@
                    @if (isLandlord)
                    {
                        @if (Model.Status == "Pending")
                        {
                            <button class="btn btn-primary" onclick="openAssignModal(@Model.RequestId)">
                                <i class="bi bi-person-plus"></i> Assign Technician
                            </button>
                        }
                        @if (Model.Status == "Completed")
                        {
                            <button class="btn btn-success" onclick="confirmCompletion(@Model.RequestId)">
                                <i class="bi bi-check-circle"></i> Confirm Completion
                            </button>
                        }
                    }

                    @* TECHNICIAN ACTIONS *@
                    @if (isTechnician && Model.AssignedTo == currentUserId)
                    {
                        @if (Model.Status == "Assigned" && string.IsNullOrEmpty(Model.TechnicianStatus))
                        {
                            <button class="btn btn-success" onclick="openAcceptModal(@Model.RequestId)">
                                <i class="bi bi-check-circle"></i> Accept Assignment
                            </button>
                            <button class="btn btn-danger" onclick="openRejectModal(@Model.RequestId)">
                                <i class="bi bi-x-circle"></i> Reject Assignment
                            </button>
                        }
                        @if (Model.Status == "InProgress")
                        {
                            <button class="btn btn-success" onclick="openCompleteModal(@Model.RequestId)">
                                <i class="bi bi-check-square"></i> Mark as Completed
                            </button>
                        }
                    }

                    <a asp-action="@(isTenant ? "TenantIndex" : isLandlord ? "LandlordIndex" : "TechnicianIndex")" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Back to List
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

@* Cancel Request Modal *@
<div class="modal-overlay" id="cancelModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Cancel Request</h3>
            <button class="modal-close" onclick="closeModal('cancelModal')">&times;</button>
        </div>
        <p>Are you sure you want to cancel this maintenance request? This action cannot be undone.</p>
        <form asp-action="CancelRequest" method="post" class="modal-actions">
            @Html.AntiForgeryToken()
            <input type="hidden" name="requestId" id="cancelRequestId" />
            <button type="button" class="btn btn-secondary" onclick="closeModal('cancelModal')">No, Keep It</button>
            <button type="submit" class="btn btn-danger">Yes, Cancel Request</button>
        </form>
    </div>
</div>

@* Rate Service Modal *@
<div class="modal-overlay" id="rateModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Rate Service</h3>
            <button class="modal-close" onclick="closeModal('rateModal')">&times;</button>
        </div>
        <form asp-action="RateMaintenance" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" name="RequestId" id="rateRequestId" />
            <input type="hidden" name="Rating" id="ratingValue" value="0" />
            <div class="form-group">
                <label class="form-label">Your Rating</label>
                <div class="rating-stars" id="ratingStars">
                    <i class="bi bi-star-fill" data-rating="1" onclick="setRating(1)"></i>
                    <i class="bi bi-star-fill" data-rating="2" onclick="setRating(2)"></i>
                    <i class="bi bi-star-fill" data-rating="3" onclick="setRating(3)"></i>
                    <i class="bi bi-star-fill" data-rating="4" onclick="setRating(4)"></i>
                    <i class="bi bi-star-fill" data-rating="5" onclick="setRating(5)"></i>
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">Feedback (Optional)</label>
                <textarea name="TenantFeedback" class="form-control" placeholder="Share your experience..."></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('rateModal')">Cancel</button>
                <button type="submit" class="btn btn-warning">Submit Rating</button>
            </div>
        </form>
    </div>
</div>

@* Assign Technician Modal *@
<div class="modal-overlay" id="assignModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Assign Technician</h3>
            <button class="modal-close" onclick="closeModal('assignModal')">&times;</button>
        </div>
        <form asp-action="AssignTechnician" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" name="RequestId" id="assignRequestId" />
            <div class="form-group">
                <label class="form-label">Select Technician</label>
                <select name="TechnicianId" class="form-control" required>
                    <option value="">-- Select a technician --</option>
                    @if (technicians != null)
                    {
                        @foreach (var tech in technicians)
                        {
                            @* <option value="@tech.UserId">@tech.FullName - @tech.Phone</option> *@
                            <option value="@tech.UserId">@tech.FullName</option>
                        }
                    }
                </select>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('assignModal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Assign</button>
            </div>
        </form>
    </div>
</div>

@* Accept Assignment Modal *@
<div class="modal-overlay" id="acceptModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Accept Assignment</h3>
            <button class="modal-close" onclick="closeModal('acceptModal')">&times;</button>
        </div>
        <form asp-action="RespondToAssignment" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" name="RequestId" id="acceptRequestId" />
            <input type="hidden" name="Status" value="Accepted" />
            <div class="form-group">
                <label class="form-label">Estimated Cost ($)</label>
                <input type="number" name="EstimatedCost" class="form-control" step="0.01" min="0" required />
            </div>
            <div class="form-group">
                <label class="form-label">Notes (Optional)</label>
                <textarea name="Notes" class="form-control" placeholder="Add any notes about the repair..."></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('acceptModal')">Cancel</button>
                <button type="submit" class="btn btn-success">Accept Assignment</button>
            </div>
        </form>
    </div>
</div>

@* Reject Assignment Modal *@
<div class="modal-overlay" id="rejectModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Reject Assignment</h3>
            <button class="modal-close" onclick="closeModal('rejectModal')">&times;</button>
        </div>
        <form asp-action="RespondToAssignment" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" name="RequestId" id="rejectRequestId" />
            <input type="hidden" name="Status" value="Rejected" />
            <div class="form-group">
                <label class="form-label">Reason for Rejection</label>
                <textarea name="Notes" class="form-control" placeholder="Please provide a reason..." required></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('rejectModal')">Cancel</button>
                <button type="submit" class="btn btn-danger">Reject Assignment</button>
            </div>
        </form>
    </div>
</div>

@* Complete Maintenance Modal *@
<div class="modal-overlay" id="completeModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Complete Maintenance</h3>
            <button class="modal-close" onclick="closeModal('completeModal')">&times;</button>
        </div>
        <form asp-action="CompleteMaintenance" method="post">
            @Html.AntiForgeryToken()
            <input type="hidden" name="RequestId" id="completeRequestId" />
            <div class="form-group">
                <label class="form-label">Actual Cost ($)</label>
                <input type="number" name="ActualCost" class="form-control" step="0.01" min="0" required />
            </div>
            <div class="form-group">
                <label class="form-label">Resolution Notes</label>
                <textarea name="ResolutionNotes" class="form-control" placeholder="Describe what was done to resolve the issue..." required></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('completeModal')">Cancel</button>
                <button type="submit" class="btn btn-success">Mark as Completed</button>
            </div>
        </form>
    </div>
</div>

@* Image Viewer Modal *@
<div class="modal-overlay" id="imageModal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h3 class="modal-title">Image</h3>
            <button class="modal-close" onclick="closeModal('imageModal')">&times;</button>
        </div>
        <img id="modalImage" src="" style="width: 100%; border-radius: 12px;" />
    </div>
</div>

@* Confirm Completion Modal *@
<div class="modal-overlay" id="confirmCompletionModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Confirm Completion</h3>
            <button class="modal-close" onclick="closeModal('confirmCompletionModal')">&times;</button>
        </div>
        <p>Are you sure you want to confirm that this maintenance request has been completed?</p>
        <form asp-action="ConfirmCompletion" method="post" class="modal-actions">
            @Html.AntiForgeryToken()
            <input type="hidden" name="requestId" id="confirmCompletionRequestId" />
            <button type="button" class="btn btn-secondary" onclick="closeModal('confirmCompletionModal')">Cancel</button>
            <button type="submit" class="btn btn-success">Confirm Completion</button>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function confirmCancel(requestId) {
            document.getElementById('cancelRequestId').value = requestId;
            openModal('cancelModal');
        }

        function openRateModal(requestId) {
            document.getElementById('rateRequestId').value = requestId;
            openModal('rateModal');
        }

        function openAssignModal(requestId) {
            document.getElementById('assignRequestId').value = requestId;
            openModal('assignModal');
        }

        function openAcceptModal(requestId) {
            document.getElementById('acceptRequestId').value = requestId;
            openModal('acceptModal');
        }

        function openRejectModal(requestId) {
            document.getElementById('rejectRequestId').value = requestId;
            openModal('rejectModal');
        }

        function openCompleteModal(requestId) {
            document.getElementById('completeRequestId').value = requestId;
            openModal('completeModal');
        }

        function confirmCompletion(requestId) {
            document.getElementById('confirmCompletionRequestId').value = requestId;
            openModal('confirmCompletionModal');
        }

        function openImageModal(imagePath) {
            document.getElementById('modalImage').src = imagePath;
            openModal('imageModal');
        }

        function setRating(rating) {
            document.getElementById('ratingValue').value = rating;
            const stars = document.querySelectorAll('#ratingStars i');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        // Close modal when clicking outside
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function (e) {
                if (e.target === this) {
                    closeModal(this.id);
                }
            });
        });
    </script>
}
