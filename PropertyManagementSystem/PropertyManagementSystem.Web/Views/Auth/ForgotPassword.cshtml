@model PropertyManagementSystem.Web.ViewModels.Auth.ForgotPasswordViewModel
@{
    ViewData["Title"] = "Forgot Password";
    Layout = "_LoginLayout";
}

<div class="pm-auth-card">
    <a asp-controller="Auth" asp-action="Login" class="pm-auth-back">
        <i class="bi bi-arrow-left"></i>
        Back to Sign In
    </a>

    <div class="pm-auth-header">
        <div class="pm-auth-icon">
            <i class="bi bi-key"></i>
        </div>
        <h1>Forgot Password?</h1>
        <p>@(Model != null && Model.IsOtpSent ? "Enter the OTP code sent to your email" : "Enter your email to receive a reset code")</p>
    </div>

    @if (TempData["Message"] != null)
    {
        <div class="pm-alert pm-alert-success">
            <i class="bi bi-check-circle-fill"></i>
            <span>@TempData["Message"]</span>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="pm-alert pm-alert-danger">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <span>@TempData["ErrorMessage"]</span>
        </div>
    }

    <form asp-action="ForgotPassword" method="post" class="pm-auth-form">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="IsOtpSent" />

        <div class="pm-form-group">
            <label asp-for="Email" class="pm-label">Email Address</label>
            <div class="pm-input-icon">
                <i class="bi bi-envelope"></i>
                <input asp-for="Email"
                       type="email"
                       class="pm-input @(Model != null && Model.IsOtpSent ? "" : "")"
                       placeholder="you@example.com"
                       autocomplete="email"
                       @@(Model != null && Model.IsOtpSent ? "readonly" : "") />
            </div>
            <span asp-validation-for="Email" class="pm-error"></span>
        </div>

        @if (Model != null && Model.IsOtpSent)
        {
            <div class="pm-form-group">
                <label asp-for="OtpCode" class="pm-label">OTP Code</label>
                <div class="pm-input-icon">
                    <i class="bi bi-shield-check"></i>
                    <input asp-for="OtpCode"
                           type="text"
                           class="pm-input"
                           placeholder="Enter 6-digit code"
                           maxlength="6"
                           inputmode="numeric"
                           pattern="[0-9]*"
                           autocomplete="one-time-code"
                           autofocus
                           style="letter-spacing: 0.3rem; font-weight: 600;" />
                </div>
                <span asp-validation-for="OtpCode" class="pm-error"></span>
                <span class="pm-hint">Check your email for the verification code</span>
            </div>

            <button type="submit" class="pm-auth-submit">
                <i class="bi bi-check-circle"></i>
                Verify Code
            </button>
        }
        else
        {
            <button type="submit" class="pm-auth-submit">
                <i class="bi bi-send"></i>
                Send Reset Code
            </button>
        }
    </form>

    <div class="pm-auth-divider">
        <span>Remember your password?</span>
    </div>

    <div class="pm-auth-footer">
        <a asp-controller="Auth" asp-action="Login">Sign in instead</a>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        // OTP input - numbers only
        const otpInput = document.querySelector('input[name="OtpCode"]');
        if (otpInput) {
            otpInput.addEventListener('input', function(e) {
                this.value = this.value.replace(/[^0-9]/g, '').slice(0, 6);
            });
        }
    </script>
}
