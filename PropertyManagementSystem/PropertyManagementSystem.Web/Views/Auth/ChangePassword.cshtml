@using PropertyManagementSystem.Web.ViewModels.Auth
@model ChangePasswordViewModel
@{
    ViewData["Title"] = "Change Password";
    Layout = "_AuthLayout";
}

<div class="pm-page">
    <div class="pm-page-header">
        <div>
            <h1 class="pm-page-title">
                <i class="bi bi-key"></i>
                Change Password
            </h1>
            <p class="pm-page-subtitle">Update your account password</p>
        </div>
    </div>

    <div class="pm-grid" style="grid-template-columns: minmax(0, 600px); justify-content: center;">
        <div class="pm-card">
            <div class="pm-card-header">
                <h4><i class="bi bi-shield-lock"></i> Password Settings</h4>
            </div>
            <div class="pm-card-body">
                @if (!ViewData.ModelState.IsValid && ViewData.ModelState.Values.Any(v => v.Errors.Any()))
                {
                    <div class="pm-alert pm-alert-danger">
                        <i class="bi bi-exclamation-triangle-fill"></i>
                        <div>@Html.ValidationSummary(false)</div>
                    </div>
                }

                <form asp-action="ChangePassword" method="post">
                    @Html.AntiForgeryToken()

                    <div class="pm-form-group">
                        <label asp-for="CurrentPassword" class="pm-label">Current Password</label>
                        <div class="pm-input-icon pm-input-icon-right">
                            <i class="bi bi-lock"></i>
                            <input asp-for="CurrentPassword"
                                   id="currentPasswordInput"
                                   type="password"
                                   class="pm-input"
                                   placeholder="Enter current password"
                                   style="padding-left: 44px; padding-right: 44px;" />
                            <button type="button" class="pm-password-toggle" onclick="togglePassword('currentPasswordInput', 'currentPasswordIcon')">
                                <i class="bi bi-eye" id="currentPasswordIcon"></i>
                            </button>
                        </div>
                        <span asp-validation-for="CurrentPassword" class="pm-error"></span>
                    </div>

                    <div class="pm-form-group">
                        <label asp-for="NewPassword" class="pm-label">New Password</label>
                        <div class="pm-input-icon pm-input-icon-right">
                            <i class="bi bi-lock-fill"></i>
                            <input asp-for="NewPassword"
                                   id="newPasswordInput"
                                   type="password"
                                   class="pm-input"
                                   placeholder="Enter new password"
                                   style="padding-left: 44px; padding-right: 44px;" />
                            <button type="button" class="pm-password-toggle" onclick="togglePassword('newPasswordInput', 'newPasswordIcon')">
                                <i class="bi bi-eye" id="newPasswordIcon"></i>
                            </button>
                        </div>
                        <span asp-validation-for="NewPassword" class="pm-error"></span>
                    </div>

                    <div class="pm-form-group">
                        <label asp-for="ConfirmPassword" class="pm-label">Confirm New Password</label>
                        <div class="pm-input-icon pm-input-icon-right">
                            <i class="bi bi-shield-check"></i>
                            <input asp-for="ConfirmPassword"
                                   id="confirmPasswordInput"
                                   type="password"
                                   class="pm-input"
                                   placeholder="Confirm new password"
                                   style="padding-left: 44px; padding-right: 44px;" />
                            <button type="button" class="pm-password-toggle" onclick="togglePassword('confirmPasswordInput', 'confirmPasswordIcon')">
                                <i class="bi bi-eye" id="confirmPasswordIcon"></i>
                            </button>
                        </div>
                        <span asp-validation-for="ConfirmPassword" class="pm-error"></span>
                    </div>

                    <div class="pm-flex pm-gap-3 pm-mt-6">
                        <a asp-controller="Dashboard" asp-action="Index" class="pm-btn pm-btn-secondary">
                            <i class="bi bi-x-lg"></i>
                            Cancel
                        </a>
                        <button type="submit" class="pm-btn pm-btn-primary pm-flex-1">
                            <i class="bi bi-check-lg"></i>
                            Update Password
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    .pm-page {
        max-width: 1200px;
        margin: 0 auto;
    }

    .pm-page-header {
        margin-bottom: var(--pm-space-6);
    }

    .pm-page-title {
        font-size: var(--pm-text-2xl);
        font-weight: var(--pm-font-bold);
        color: var(--pm-text);
        margin: 0 0 var(--pm-space-2);
        display: flex;
        align-items: center;
        gap: var(--pm-space-3);
    }

    .pm-page-title i {
        color: var(--pm-primary);
    }

    .pm-page-subtitle {
        font-size: var(--pm-text-sm);
        color: var(--pm-text-secondary);
        margin: 0;
    }

    .pm-password-toggle {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--pm-text-muted);
        cursor: pointer;
        padding: 8px;
        z-index: 5;
    }

    .pm-password-toggle:hover {
        color: var(--pm-primary);
    }
</style>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        function togglePassword(inputId, iconId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(iconId);
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.replace('bi-eye', 'bi-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.replace('bi-eye-slash', 'bi-eye');
            }
        }
    </script>
}
