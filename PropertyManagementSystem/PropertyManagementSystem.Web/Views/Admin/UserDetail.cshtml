@model PropertyManagementSystem.BLL.DTOs.Admin.AdminUserDto
@{
    ViewData["Title"] = "User Detail";
    Layout = "_AuthLayout";
    var roles = ViewBag.Roles as List<string> ?? new List<string>();
}

<style>
    .detail-container { padding: 10px 0; max-width: 900px; }
    .back-link { display: inline-flex; align-items: center; gap: 6px; color: #2563eb; text-decoration: none; font-size: 14px; margin-bottom: 20px; }
    .back-link:hover { color: #1d4ed8; }
    .detail-header { display: flex; align-items: center; gap: 20px; margin-bottom: 30px; }
    .detail-avatar { width: 72px; height: 72px; border-radius: 50%; background: #2563eb; color: white; display: flex; align-items: center; justify-content: center; font-size: 28px; font-weight: 700; flex-shrink: 0; }
    .detail-title h1 { font-size: 24px; font-weight: 700; color: #1e293b; margin: 0 0 4px; }
    .detail-title p { color: #64748b; margin: 0; font-size: 14px; }
    .badge-role { padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; margin-right: 6px; }
    .badge-admin { background: #fee2e2; color: #dc2626; }
    .badge-member { background: #dbeafe; color: #2563eb; }
    .badge-technician { background: #ffedd5; color: #ea580c; }
    .section-card { background: white; border-radius: 16px; padding: 24px; border: 1px solid #e2e8f0; margin-bottom: 20px; }
    .section-card h2 { font-size: 18px; font-weight: 600; color: #1e293b; margin: 0 0 20px; padding-bottom: 12px; border-bottom: 1px solid #f1f5f9; }
    .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .info-item label { display: block; font-size: 13px; font-weight: 500; color: #64748b; margin-bottom: 4px; }
    .info-item .value { font-size: 15px; color: #1e293b; font-weight: 500; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px; }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 6px; }
    .form-group input, .form-group select { width: 100%; padding: 10px 14px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 14px; }
    .form-group input:focus, .form-group select:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,0.1); }
    .form-check-inline { display: flex; align-items: center; gap: 8px; }
    .form-check-inline input[type="checkbox"] { width: 18px; height: 18px; }
    .btn-save { background: #2563eb; color: white; border: none; padding: 10px 24px; border-radius: 8px; font-weight: 500; cursor: pointer; }
    .btn-save:hover { background: #1d4ed8; }
    .btn-danger { background: #dc2626; color: white; border: none; padding: 10px 24px; border-radius: 8px; font-weight: 500; cursor: pointer; }
    .btn-danger:hover { background: #b91c1c; }
    .btn-warning { background: #f59e0b; color: white; border: none; padding: 10px 24px; border-radius: 8px; font-weight: 500; cursor: pointer; }
    .btn-warning:hover { background: #d97706; }
    .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 6px; }
    .status-active { background: #10b981; }
    .status-inactive { background: #ef4444; }
</style>

<div class="detail-container">
    <a href="@Url.Action("Users", "Admin")" class="back-link">
        <i class="bi bi-arrow-left"></i> Back to Users
    </a>

    <div class="detail-header">
        <div class="detail-avatar">@(Model.FullName.Length > 0 ? Model.FullName[0].ToString().ToUpper() : "?")</div>
        <div class="detail-title">
            <h1>
                @Model.FullName
                <span class="status-dot @(Model.IsActive ? "status-active" : "status-inactive")"></span>
            </h1>
            <p>
                @Model.Email &middot;
                @foreach (var role in Model.Roles)
                {
                    var bc = role == "Admin" ? "badge-admin" : role == "Technician" ? "badge-technician" : "badge-member";
                    <span class="badge-role @bc">@role</span>
                }
            </p>
        </div>
    </div>

    <div class="section-card">
        <h2>User Information</h2>
        <div class="info-grid">
            <div class="info-item">
                <label>Email</label>
                <div class="value">@Model.Email</div>
            </div>
            <div class="info-item">
                <label>Phone</label>
                <div class="value">@(Model.PhoneNumber ?? "N/A")</div>
            </div>
            <div class="info-item">
                <label>Address</label>
                <div class="value">@(Model.Address ?? "N/A")</div>
            </div>
            <div class="info-item">
                <label>Date of Birth</label>
                <div class="value">@(Model.DateOfBirth?.ToString("MMM dd, yyyy") ?? "N/A")</div>
            </div>
            <div class="info-item">
                <label>Created At</label>
                <div class="value">@Model.CreatedAt.ToString("MMM dd, yyyy HH:mm")</div>
            </div>
            <div class="info-item">
                <label>Last Login</label>
                <div class="value">@(Model.LastLoginAt?.ToString("MMM dd, yyyy HH:mm") ?? "Never")</div>
            </div>
            <div class="info-item">
                <label>Email Verified</label>
                <div class="value">@(Model.EmailVerified ? "Yes" : "No")</div>
            </div>
            <div class="info-item">
                <label>Status</label>
                <div class="value">@(Model.IsActive ? "Active" : "Inactive")</div>
            </div>
        </div>
    </div>

    <div class="section-card">
        <h2>Edit User</h2>
        <form method="post" asp-action="UpdateUser">
            @Html.AntiForgeryToken()
            <input type="hidden" name="UserId" value="@Model.UserId" />
            <div class="form-row">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="FullName" value="@Model.FullName" required />
                </div>
                <div class="form-group">
                    <label>Phone Number</label>
                    <input type="text" name="PhoneNumber" value="@Model.PhoneNumber" />
                </div>
            </div>
            <div class="form-group">
                <label>Address</label>
                <input type="text" name="Address" value="@Model.Address" />
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Role</label>
                    <select name="Role">
                        @foreach (var r in roles)
                        {
                            <option value="@r" selected="@(Model.Roles.Contains(r))">@r</option>
                        }
                    </select>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <div class="form-check-inline" style="margin-top: 6px;">
                        <input type="checkbox" name="IsActive" value="true" @(Model.IsActive ? "checked" : "") />
                        <label>Active</label>
                    </div>
                </div>
            </div>
            <button type="submit" class="btn-save"><i class="bi bi-check-lg"></i> Save Changes</button>
        </form>
    </div>

    <div class="section-card">
        <h2>Reset Password</h2>
        <form method="post" asp-action="ResetPassword">
            @Html.AntiForgeryToken()
            <input type="hidden" name="userId" value="@Model.UserId" />
            <div class="form-group">
                <label>New Password</label>
                <input type="password" name="newPassword" minlength="6" required placeholder="Enter new password (min 6 chars)" />
            </div>
            <button type="submit" class="btn-warning"
                    onclick="return confirm('Are you sure you want to reset this user\'s password?')">
                <i class="bi bi-key"></i> Reset Password
            </button>
        </form>
    </div>
</div>
